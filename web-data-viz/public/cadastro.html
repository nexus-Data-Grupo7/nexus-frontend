<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Cadastro</title>
    <link rel="stylesheet" href="./css/cadastro.css">
</head>

<body>

    <div class="container">

        <div class="left-area">
            <div class="phone-box">
                <img src="./images/celularNexus.png" class="phone-img">
            </div>
            <div class="grupo-linhas">
                <img src="images/linhas_grupo.svg" alt="">
            </div>

            <div class="description">
                Nosso propósito é <strong>fortalecer a comunidade gamer</strong>, dar visibilidade a novos talentos
                e apoiar organizações e <strong>patrocinadores</strong> com <strong>dados confiáveis</strong>.
            </div>
        </div>

        <div class="form-area">
            <h1>Cadastro</h1>

            <div class="tipo-usuario">
                <label><input type="radio" name="tipoUsuario" value="jogador" checked onchange="alterarTipoLogin()">
                    Jogador</label>
                <label><input type="radio" name="tipoUsuario" value="organizacao" onchange="alterarTipoLogin()">
                    Organização</label>
            </div>

            <div class="form-container">

                <div class="form-area parte-1">

                    <span>E-mail</span>
                    <div class="input">
                        <input type="text" id="input_email" placeholder="xpto@gmail.com">
                    </div>

                    <span>Senha</span>
                    <div class="input">
                        <input type="password" id="input_senha" placeholder="*******">
                    </div>

                    <span>Confirmar senha</span>
                    <div class="input">
                        <input type="password" id="input_confirmaSenha" placeholder="*******">
                    </div>

                    <div id="campos_jogador">
                        <span>Nome</span>
                        <div class="input">
                            <input type="text" id="input_nome" placeholder="Seu nome">
                        </div>
                    </div>

                </div>

                <div class="form-area parte-2">

                    <div>
                        <span>Data de nascimento</span>
                        <div class="input">
                            <input type="text" id="input_idade">
                        </div>

                        <span>Game Name</span>
                        <div class="input">
                            <input type="text" id="input_gameName" placeholder="Ex: Faker">
                        </div>

                        <span>Tagline</span>
                        <div class="input">
                            <input type="text" id="input_tagline" placeholder="Ex: #1234">
                        </div>

                        <span>Região</span>
                        <select id="select_regiao">
                            <option value="1">BR1 - Brasil</option>
                            <option value="2">NA1 - América do Norte</option>
                            <option value="3">LA1 - América Latina Norte</option>
                            <option value="4">LA2 - América Latina Sul</option>
                            <option value="5">KR - Coreia</option>
                        </select>
                    </div>


                    <div id="campos_organizacao" style="display: none;">
                        <span>Nome da Organização</span>
                        <div class="input">
                            <input type="text" id="input_nomeOrg" placeholder="Nome completo da organização">
                        </div>

                        <span>Sigla</span>
                        <div class="input">
                            <input type="text" id="input_sigla" placeholder="Ex: T1, FNC">
                        </div>

                        <span>CNPJ</span>
                        <div class="input">
                            <input type="text" id="input_cnpj" placeholder="Somente números">
                        </div>
                    </div>
                </div>

            </div>



            <button class="btn">Cadastrar</button>

            <div class="login-text">Já possui uma conta? <a href="#">clique aqui</a></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/js-sha256@0.9.0/build/sha256.min.js"></script>

    <script>
        function alterarTipoLogin() {
            const tipoSelecionado = document.querySelector('input[name="tipoUsuario"]:checked').value;
            document.getElementById("campos_jogador").style.display = tipoSelecionado === "jogador" ? "block" : "none";
            document.getElementById("campos_organizacao").style.display = tipoSelecionado === "organizacao" ? "block" : "none";
        }

        async function cadastrar() {
            const email = document.getElementById("input_email").value.trim();
            const senha = document.getElementById("input_senha").value.trim();
            const confirma = document.getElementById("input_confirmaSenha").value.trim();
            const tipoConta = document.querySelector('input[name="tipoUsuario"]:checked').value.toUpperCase();

            if (!email || !senha || !confirma) {
                alert("Preencha todos os campos obrigatórios!");
                return;
            }

            if (senha !== confirma) {
                alert("As senhas não coincidem!");
                return;
            }

            const senhaHash = sha256(senha);

            let body = {
                emailServer: email,
                senhaServer: senhaHash,
                tipoContaServer: tipoConta
            };

            if (tipoConta === "JOGADOR") {
                body.nome = document.getElementById("input_nome").value.trim();
                body.gameName = document.getElementById("input_gameName").value.trim();
                body.tagline = document.getElementById("input_tagline").value.trim();
                body.idRegiao = document.getElementById("select_regiao").value;
            } else {
                body.nomeOrg = document.getElementById("input_nomeOrg").value.trim();
                body.sigla = document.getElementById("input_sigla").value.trim();
                body.cnpj = document.getElementById("input_cnpj").value.trim();
            }

            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            })
                .then(res => {
                    if (res.ok) {
                        alert("Cadastro realizado com sucesso!");
                        window.location.href = "login.html";
                    } else {
                        alert("Erro ao cadastrar!");
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("Erro de conexão com o servidor!");
                });
        }
    </script>
</body>

</html>